{% extends 'base.html' %}
{% block content %}
<div class="fade-in">
  <div style="max-width:900px;margin:0 auto;">
    <div style="margin-bottom:30px;">
      <h2 style="color:#2c3e50;margin-bottom:10px;">üóëÔ∏è Dispose Asset</h2>
      <p style="color:#7f8c8d;">Retire or dispose of assets with proper record keeping and documentation</p>
    </div>

    <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);padding:30px;">
      <form method="post">
        <!-- Asset Selection Section -->
        <div style="margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #e74c3c;">
          <h3 style="color:#e74c3c;margin-bottom:20px;display:flex;align-items:center;gap:10px;">
            <span>üì¶</span> Asset Selection
          </h3>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
            <div>
              <label style="display:block;font-weight:600;color:#2c3e50;margin-bottom:8px;">
                Select Asset <span style="color:#e74c3c;">*</span>
              </label>
              <select name="asset_name" id="asset_name" required onchange="updateAssetInfo()"
                style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fafafa;">
                <option value="">-- Select an asset --</option>
                {% for name, data in assets %}
                <option value="{{ name }}" data-quantity="{{ data.quantity }}" data-price="{{ data.price }}"
                  data-category="{{ data.category }}">
                  {{ name }} (Available: {{ data.quantity }})
                </option>
                {% endfor %}
              </select>
            </div>

            <div>
              <label style="display:block;font-weight:600;color:#2c3e50;margin-bottom:8px;">
                Quantity to Dispose <span style="color:#e74c3c;">*</span>
              </label>
              <input type="number" name="quantity" id="quantity" value="1" min="1" required
                style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fafafa;">
              <small id="available_qty" style="color:#7f8c8d;display:block;margin-top:5px;">Select an asset
                first</small>
            </div>
          </div>

          <!-- Asset Info Display -->
          <div id="asset_info"
            style="display:none;background:#fff3cd;border-left:4px solid #ffc107;padding:15px;border-radius:6px;margin-top:15px;">
            <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:15px;">
              <div>
                <div style="font-size:12px;color:#856404;font-weight:600;">CATEGORY</div>
                <div id="info_category" style="color:#2c3e50;font-size:15px;margin-top:3px;">-</div>
              </div>
              <div>
                <div style="font-size:12px;color:#856404;font-weight:600;">AVAILABLE</div>
                <div id="info_quantity" style="color:#2c3e50;font-size:15px;margin-top:3px;">-</div>
              </div>
              <div>
                <div style="font-size:12px;color:#856404;font-weight:600;">UNIT PRICE</div>
                <div id="info_price" style="color:#2c3e50;font-size:15px;margin-top:3px;">-</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Disposal Details Section -->
        <div style="margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid #95a5a6;">
          <h3 style="color:#95a5a6;margin-bottom:20px;display:flex;align-items:center;gap:10px;">
            <span>üìã</span> Disposal Details
          </h3>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;">
            <div>
              <label style="display:block;font-weight:600;color:#2c3e50;margin-bottom:8px;">
                Reason for Disposal <span style="color:#e74c3c;">*</span>
              </label>
              <select name="reason" required
                style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fafafa;">
                <option value="">-- Select reason --</option>
                <option value="End of Life">End of Life</option>
                <option value="Obsolete">Obsolete</option>
                <option value="Damaged Beyond Repair">Damaged Beyond Repair</option>
                <option value="Lost">Lost</option>
                <option value="Stolen">Stolen</option>
                <option value="Sold">Sold</option>
                <option value="Donated">Donated</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <div>
              <label style="display:block;font-weight:600;color:#2c3e50;margin-bottom:8px;">
                Disposal Method <span style="color:#e74c3c;">*</span>
              </label>
              <select name="disposal_method" required
                style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fafafa;">
                <option value="">-- Select method --</option>
                <option value="Recycling">Recycling</option>
                <option value="Donation">Donation</option>
                <option value="Sale">Sale</option>
                <option value="Trash/Landfill">Trash/Landfill</option>
                <option value="Return to Vendor">Return to Vendor</option>
                <option value="Destruction">Destruction</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div>
            <label style="display:block;font-weight:600;color:#2c3e50;margin-bottom:8px;">
              Additional Notes
            </label>
            <textarea name="notes" rows="4" placeholder="Enter any additional details about the disposal..."
              style="width:100%;padding:12px;border:2px solid #e0e0e0;border-radius:8px;font-size:15px;background:#fafafa;resize:vertical;"></textarea>
          </div>
        </div>

        <!-- Action Buttons -->
        <div style="display:flex;gap:15px;justify-content:flex-end;">
          <a href="{{ url_for('assets') }}"
            style="background:#95a5a6;color:white;padding:12px 30px;border-radius:8px;text-decoration:none;font-weight:600;display:inline-flex;align-items:center;gap:8px;">
            Cancel
          </a>
          <button type="submit"
            style="background:linear-gradient(135deg,#e74c3c 0%,#c0392b 100%);color:white;padding:12px 30px;border:none;border-radius:8px;font-weight:600;cursor:pointer;display:inline-flex;align-items:center;gap:8px;box-shadow:0 2px 8px rgba(231,76,60,0.3);">
            <span>üóëÔ∏è</span> Dispose Asset
          </button>
        </div>
      </form>
    </div>

    <!-- Warning Notice -->
    <div style="background:#fff3cd;border-left:4px solid #ffc107;padding:20px;margin-top:30px;border-radius:8px;">
      <div style="font-weight:600;color:#856404;margin-bottom:8px;display:flex;align-items:center;gap:8px;">
        <span style="font-size:20px;">‚ö†Ô∏è</span> Important Notice
      </div>
      <div style="color:#856404;font-size:14px;">
        Disposing an asset will permanently reduce its quantity from the inventory. This action will be recorded in the
        transaction history for audit purposes. Please ensure all disposal documentation is completed before proceeding.
      </div>
    </div>

    <!-- Recent Disposals -->
    <div style="margin-top:40px;">
      <h3 style="color:#2c3e50;margin-bottom:20px;">Recent Disposals</h3>
      <div style="background:white;border-radius:12px;box-shadow:0 2px 10px rgba(0,0,0,0.1);overflow:hidden;">
        <div class="table-responsive">
          <table>
            <thead>
              <tr>
                <th>Date</th>
                <th>Asset</th>
                <th>Quantity</th>
                <th>Reason</th>
                <th>Method</th>
                <th>User</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="6" style="text-align:center;color:#7f8c8d;padding:30px;">
                  No recent disposals recorded
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  function updateAssetInfo() {
    const select = document.getElementById('asset_name');
    const selectedOption = select.options[select.selectedIndex];
    const assetInfo = document.getElementById('asset_info');
    const quantityInput = document.getElementById('quantity');
    const availableQty = document.getElementById('available_qty');

    if (selectedOption.value) {
      const quantity = selectedOption.getAttribute('data-quantity');
      const price = selectedOption.getAttribute('data-price');
      const category = selectedOption.getAttribute('data-category');

      // Update info display
      document.getElementById('info_category').textContent = category;
      document.getElementById('info_quantity').textContent = quantity;
      document.getElementById('info_price').textContent = 'VT' + parseFloat(price).toFixed(2);

      // Update quantity constraints
      quantityInput.max = quantity;
      availableQty.textContent = `Available: ${quantity} units`;
      availableQty.style.color = '#27ae60';

      // Show info panel
      assetInfo.style.display = 'block';
    } else {
      assetInfo.style.display = 'none';
      availableQty.textContent = 'Select an asset first';
      availableQty.style.color = '#7f8c8d';
    }
  }

  // Validate quantity on change
  document.getElementById('quantity').addEventListener('input', function () {
    const max = parseInt(this.max);
    const value = parseInt(this.value);

    if (value > max) {
      this.value = max;
      alert('Quantity cannot exceed available stock: ' + max);
    }
  });
</script>

<style>
  select:focus,
  input:focus,
  textarea:focus {
    border-color: #e74c3c !important;
    box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1) !important;
  }

  button[type="submit"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4) !important;
  }

  a[href]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }
</style>
{% endblock %}