{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>üë• Employees Management</h1>
    <p>Manage employee records and information</p>
</div>

<!-- Statistics Dashboard -->
<div class="dashboard" style="margin-bottom: 30px;">
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">üë§</div>
        <div class="card-content">
            <h3>{{ total_count }}</h3>
            <p>Total Employees</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">‚úÖ</div>
        <div class="card-content">
            <h3>{{ active_count }}</h3>
            <p>Active Employees</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">üè¢</div>
        <div class="card-content">
            <h3>{{ dept_with_employees }}</h3>
            <p>Departments</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">üí∞</div>
        <div class="card-content">
            <h3>VUV {{ "{:,.0f}".format(total_salary) }}</h3>
            <p>Total Payroll</p>
        </div>
    </div>
</div>

<!-- Add Employee Button -->
<div style="margin-bottom: 20px;">
    <button onclick="document.getElementById('add-employee-form').style.display='block'" class="btn btn-primary">
        ‚ûï Add New Employee
    </button>
</div>

<!-- Add Employee Form (Hidden by default) -->
<div id="add-employee-form" class="form-card" style="display: none; margin-bottom: 30px;">
    <h2 style="margin-bottom: 20px;">‚ûï Add New Employee</h2>
    <form method="POST" action="{{ url_for('add_employee') }}" class="form-grid" enctype="multipart/form-data">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        
        <div class="form-group" style="grid-column: span 2;">
            <label for="profile_photo">Profile Photo</label>
            <input type="file" id="profile_photo" name="profile_photo" accept="image/png,image/jpeg,image/jpg,image/gif">
            <small style="color: #666;">Allowed formats: PNG, JPG, JPEG, GIF</small>
        </div>
        
        <div class="form-group">
            <label for="employee_id">Employee ID *</label>
            <input type="text" id="employee_id" name="employee_id" required placeholder="EMP001">
        </div>
        
        <div class="form-group">
            <label for="first_name">First Name *</label>
            <input type="text" id="first_name" name="first_name" required>
        </div>
        
        <div class="form-group">
            <label for="last_name">Last Name *</label>
            <input type="text" id="last_name" name="last_name" required>
        </div>
        
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="employee@vbos.gov.vu">
        </div>
        
        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="text" id="phone" name="phone" placeholder="+678-555-0100">
        </div>
        
        <div class="form-group">
            <label for="mobile">Mobile</label>
            <input type="text" id="mobile" name="mobile" placeholder="+678-555-0100">
        </div>
        
        <div class="form-group">
            <label for="date_of_birth">Date of Birth</label>
            <input type="date" id="date_of_birth" name="date_of_birth">
        </div>
        
        <div class="form-group">
            <label for="gender">Gender</label>
            <select id="gender" name="gender">
                <option value="">Select...</option>
                <option value="Male">Male</option>
                <option value="Female">Female</option>
                <option value="Other">Other</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="department_id">Department</label>
            <select id="department_id" name="department_id">
                <option value="">Select...</option>
                {% for dept in departments %}
                <option value="{{ dept.id }}">{{ dept.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="form-group">
            <label for="position">Position</label>
            <input type="text" id="position" name="position" placeholder="e.g., Systems Analyst">
        </div>
        
        <div class="form-group">
            <label for="qualification">Qualification</label>
            <input type="text" id="qualification" name="qualification" placeholder="e.g., Bachelor's in IT, MBA, Diploma">
        </div>
        
        <div class="form-group">
            <label for="employment_type">Employment Type</label>
            <select id="employment_type" name="employment_type">
                <option value="Full-Time" selected>Full-Time</option>
                <option value="Part-Time">Part-Time</option>
                <option value="Contract">Contract</option>
                <option value="Temporary">Temporary</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="hire_date">Hire Date</label>
            <input type="date" id="hire_date" name="hire_date">
        </div>
        
        <div class="form-group">
            <label for="salary">Salary (VUV)</label>
            <input type="number" id="salary" name="salary" step="0.01" placeholder="0.00">
        </div>
        
        <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" placeholder="Port Vila">
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
            <label for="address">Address</label>
            <input type="text" id="address" name="address">
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="2"></textarea>
        </div>
        
        <div class="form-group" style="grid-column: span 2; display: flex; gap: 10px;">
            <button type="submit" class="btn btn-primary">‚ûï Add Employee</button>
            <button type="button" onclick="document.getElementById('add-employee-form').style.display='none'" class="btn btn-secondary">Cancel</button>
        </div>
    </form>
</div>

<!-- Filter and Search -->
<div class="filter-section" style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
    <form method="GET" style="display: flex; gap: 10px; flex: 1; flex-wrap: wrap;">
        <select name="status" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All Status</option>
            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active Only</option>
            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactive Only</option>
        </select>
        
        <select name="department" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all">All Departments</option>
            {% for dept in departments %}
            <option value="{{ dept.id }}" {% if department_filter == dept.id|string %}selected{% endif %}>{{ dept.name }}</option>
            {% endfor %}
        </select>
        
        <select name="employment_type" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all">All Types</option>
            <option value="Full-Time" {% if employment_type == 'Full-Time' %}selected{% endif %}>Full-Time</option>
            <option value="Part-Time" {% if employment_type == 'Part-Time' %}selected{% endif %}>Part-Time</option>
            <option value="Contract" {% if employment_type == 'Contract' %}selected{% endif %}>Contract</option>
            <option value="Temporary" {% if employment_type == 'Temporary' %}selected{% endif %}>Temporary</option>
        </select>
        
        <input type="text" name="search" value="{{ search_query }}" placeholder="Search employees..." style="flex: 1; min-width: 200px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
        
        <button type="submit" class="btn btn-primary">üîç Search</button>
        {% if status_filter != 'all' or department_filter != 'all' or employment_type != 'all' or search_query %}
            <a href="{{ url_for('employees') }}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Employees List -->
<div class="table-card">
    <h2 style="margin-bottom: 20px;">üìã Employees List</h2>
    
    {% if employees %}
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Photo</th>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Department</th>
                    <th>Position</th>
                    <th>Qualification</th>
                    <th>Type</th>
                    <th>Contact</th>
                    <th>Hire Date</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for emp in employees %}
                <tr>
                    <td>
                        {% if emp.photo_path %}
                        <img src="{{ url_for('static', filename='../' + emp.photo_path) }}" 
                             alt="{{ emp.first_name }}" 
                             style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover; border: 2px solid #ddd;">
                        {% else %}
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; border: 2px solid #ddd;">
                            <span style="font-size: 20px;">üë§</span>
                        </div>
                        {% endif %}
                    </td>
                    <td><strong>{{ emp.employee_id }}</strong></td>
                    <td>{{ emp.first_name }} {{ emp.last_name }}</td>
                    <td>{{ emp.department_name or '-' }}</td>
                    <td>{{ emp.position or '-' }}</td>
                    <td>{{ emp.qualification or '-' }}</td>
                    <td><span class="badge badge-info">{{ emp.employment_type }}</span></td>
                    <td>
                        {% if emp.email %}<div>üìß {{ emp.email }}</div>{% endif %}
                        {% if emp.phone %}<div>üìû {{ emp.phone }}</div>{% endif %}
                    </td>
                    <td>{{ emp.hire_date.strftime('%Y-%m-%d') if emp.hire_date else '-' }}</td>
                    <td>
                        {% if emp.is_active %}
                            <span class="badge badge-success">Active</span>
                        {% else %}
                            <span class="badge badge-danger">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <a href="{{ url_for('view_employee', emp_id=emp.id) }}" class="btn-action" title="View">üëÅÔ∏è</a>
                        <a href="{{ url_for('edit_employee', emp_id=emp.id) }}" class="btn-action" title="Edit">‚úèÔ∏è</a>
                        <form method="POST" action="{{ url_for('delete_employee', emp_id=emp.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this employee?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="btn-action btn-delete" title="Delete">üóëÔ∏è</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p style="text-align: center; padding: 40px; color: #999;">
            {% if search_query %}
                No employees found matching "{{ search_query }}"
            {% else %}
                No employees found. Add your first employee above.
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>

<style>
.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
}

.badge-info {
    background: #d1ecf1;
    color: #0c5460;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
}
</style>

{% endblock %}
