{% extends "base.html" %}

{% block content %}
<div class="page-header">
    <h1>ğŸ¢ Departments/Cost Centers Management</h1>
    <p>Manage organizational departments and cost centers</p>
</div>

<!-- Statistics Dashboard -->
<div class="dashboard" style="margin-bottom: 30px;">
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">ğŸ“Š</div>
        <div class="card-content">
            <h3>{{ total_count }}</h3>
            <p>Total Departments</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">âœ…</div>
        <div class="card-content">
            <h3>{{ active_count }}</h3>
            <p>Active Departments</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">ğŸ’°</div>
        <div class="card-content">
            <h3>VUV {{ "{:,.2f}".format(total_budget) }}</h3>
            <p>Total Budget</p>
        </div>
    </div>
    <div class="card">
        <div class="card-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">ğŸ‘¤</div>
        <div class="card-content">
            <h3>{{ manager_count }}</h3>
            <p>Department Managers</p>
        </div>
    </div>
</div>

<!-- Add Department Form -->
<div class="form-card" style="margin-bottom: 30px;">
    <h2 style="margin-bottom: 20px;">â• Add New Department/Cost Center</h2>
    <form method="POST" action="{{ url_for('add_department') }}" class="form-grid">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
        
        <div class="form-group">
            <label for="name">Department/Cost Center Name *</label>
            <input type="text" id="name" name="name" required placeholder="e.g., Information Technology">
        </div>
        
        <div class="form-group">
            <label for="code">Dept/Cost Center Code *</label>
            <input type="text" id="code" name="code" required placeholder="e.g., IT" maxlength="50" style="text-transform: uppercase;">
        </div>
        
        <div class="form-group">
            <label for="manager">Manager</label>
            <input type="text" id="manager" name="manager" placeholder="e.g., John Smith">
        </div>
        
        <div class="form-group">
            <label for="location">Location</label>
            <input type="text" id="location" name="location" placeholder="e.g., Building A, Floor 3">
        </div>
        
        <div class="form-group">
            <label for="budget">Budget (VUV)</label>
            <input type="number" id="budget" name="budget" step="0.01" min="0" value="0" placeholder="0.00">
        </div>
        
        <div class="form-group">
            <label for="phone">Phone</label>
            <input type="text" id="phone" name="phone" placeholder="+678-123-4567">
        </div>
        
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="department@vbos.gov.vu">
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="3" placeholder="Brief description of the department's responsibilities..."></textarea>
        </div>
        
        <div class="form-group" style="grid-column: span 2;">
            <button type="submit" class="btn btn-primary">
                â• Add Department
            </button>
        </div>
    </form>
</div>

<!-- Filter and Search -->
<div class="filter-section" style="display: flex; gap: 15px; margin-bottom: 20px; align-items: center;">
    <form method="GET" style="display: flex; gap: 10px; flex: 1;">
        <select name="status" onchange="this.form.submit()" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
            <option value="all" {% if status_filter == 'all' %}selected{% endif %}>All Departments</option>
            <option value="active" {% if status_filter == 'active' %}selected{% endif %}>Active Only</option>
            <option value="inactive" {% if status_filter == 'inactive' %}selected{% endif %}>Inactive Only</option>
        </select>
        
        <input type="text" name="search" value="{{ search_query }}" placeholder="Search departments..." style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
        
        <button type="submit" class="btn btn-primary">ğŸ” Search</button>
        {% if status_filter != 'all' or search_query %}
            <a href="{{ url_for('departments') }}" class="btn btn-secondary">Clear</a>
        {% endif %}
    </form>
</div>

<!-- Departments List -->
<div class="table-card">
    <h2 style="margin-bottom: 20px;">ğŸ“‹ Departments List</h2>
    
    {% if departments %}
    <div class="table-responsive">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Manager</th>
                    <th>Location</th>
                    <th>Budget</th>
                    <th>Contact</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for dept in departments %}
                <tr>
                    <td><strong>{{ dept.code }}</strong></td>
                    <td>{{ dept.name }}</td>
                    <td>{{ dept.manager or '-' }}</td>
                    <td>{{ dept.location or '-' }}</td>
                    <td>VUV {{ "{:,.2f}".format(dept.budget) if dept.budget else '0.00' }}</td>
                    <td>
                        {% if dept.phone or dept.email %}
                            {% if dept.phone %}<div>ğŸ“ {{ dept.phone }}</div>{% endif %}
                            {% if dept.email %}<div>ğŸ“§ {{ dept.email }}</div>{% endif %}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if dept.is_active %}
                            <span class="badge badge-success">Active</span>
                        {% else %}
                            <span class="badge badge-danger">Inactive</span>
                        {% endif %}
                    </td>
                    <td class="actions">
                        <a href="{{ url_for('edit_department', dept_id=dept.id) }}" class="btn-action btn-edit" title="Edit">âœï¸</a>
                        <form method="POST" action="{{ url_for('delete_department', dept_id=dept.id) }}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this department?');">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                            <button type="submit" class="btn-action btn-delete" title="Delete">ğŸ—‘ï¸</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <div class="empty-state">
        <p style="text-align: center; padding: 40px; color: #999;">
            {% if search_query %}
                No departments found matching "{{ search_query }}"
            {% else %}
                No departments found. Add your first department above.
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>

<style>
.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 5px;
    font-weight: 500;
    color: #333;
}

.form-group input,
.form-group textarea,
.form-group select {
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 14px;
}

.form-group textarea {
    resize: vertical;
    font-family: inherit;
}

.badge {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.badge-success {
    background: #d4edda;
    color: #155724;
}

.badge-danger {
    background: #f8d7da;
    color: #721c24;
}

.btn-action {
    padding: 6px 10px;
    border: none;
    background: transparent;
    cursor: pointer;
    font-size: 16px;
    text-decoration: none;
    display: inline-block;
}

.btn-edit:hover {
    transform: scale(1.2);
}

.btn-delete {
    color: #dc3545;
}

.btn-delete:hover {
    transform: scale(1.2);
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-group[style*="span 2"] {
        grid-column: span 1 !important;
    }
}
</style>

{% endblock %}
