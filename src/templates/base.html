<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or 'Asset Management System' }}</title>
  <link rel="stylesheet" href="/static/css/styles.css?v=2.0">
</head>
<body>
  <!-- Mobile Menu Toggle -->
  <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle navigation menu">
    â˜°
  </button>
  
  <div class="sidebar">
    <div class="sidebar-header">
      <a href="/" class="logo">
        <img src="/static/asset.png" alt="Vanuatu Bureau of Statistics logo">
      </a>
      <div class="brand">
        <h1>Asset Management</h1>
        <div class="sub">Vanuatu Bureau of Statistics</div>
      </div>
    </div>
    <ul class="sidebar-menu">
  <!-- Dashboard -->
  <li><a href='/'><i>ğŸ </i>Dashboard</a></li>
  
  <!-- Assets Management -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ“¦</i>Assets <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/assets'><i>ğŸ“‹</i>List of Assets</a></li>
      <li><a href='/add'><i>â•</i>Add an Asset</a></li>
      <li><a href='/update'><i>ğŸ”„</i>Update Quantity</a></li>
      <li><a href='/checkout'><i>ğŸ“¤</i>Check Out</a></li>
      <li><a href='/checkin'><i>ğŸ“¥</i>Check In</a></li>
      <li><a href='/lease'><i>ğŸ“</i>Lease</a></li>
      <li><a href='/lease-return'><i>â†©ï¸</i>Lease Return</a></li>
      <li><a href='/maintenance'><i>ğŸ”§</i>Maintenance</a></li>
      <li><a href='/move'><i>ğŸšš</i>Move</a></li>
      <li><a href='/reserve'><i>ğŸ”–</i>Reserve</a></li>
      <li><a href='/dispose'><i>ğŸ—‘ï¸</i>Dispose</a></li>
    </ul>
  </li>
  
  <!-- People & Organizations -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ‘¥</i>People <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/employees'><i>ğŸ‘¨â€ï¿½</i>Employees</a></li>
      <li><a href='/customers'><i>ï¿½</i>Customers</a></li>
      <li><a href='/suppliers'><i>ğŸ¢</i>Suppliers</a></li>
    </ul>
  </li>
  
  <!-- Tools -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ› ï¸</i>Tools <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/import'><i>ğŸ“¥</i>Import Data</a></li>
      <li><a href='/export'><i>ğŸ“¤</i>Export Data</a></li>
      <li><a href='/document-gallery'><i>ğŸ“„</i>Document Gallery</a></li>
      <li><a href='/image-gallery'><i>ğŸ–¼ï¸</i>Image Gallery</a></li>
    </ul>
  </li>
  
  <!-- Reports -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ“Š</i>Reports <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/reports/automated'><i>ğŸ¤–</i>Automated Report</a></li>
      <li><a href='/reports/custom'><i>âœï¸</i>Custom Report</a></li>
      <li><a href='/reports/inventory'><i>ğŸ“¦</i>Inventory Report</a></li>
      <li><a href='/reports/asset'><i>ğŸ·ï¸</i>Asset Report</a></li>
      <li><a href='/reports/audit'><i>ğŸ”</i>Audit Report</a></li>
      <li><a href='/reports/checkout'><i>ğŸ“¤</i>Check-out Report</a></li>
      <li><a href='/reports/contract'><i>ğŸ“„</i>Contract Report</a></li>
      <li><a href='/reports/depreciation'><i>ğŸ“‰</i>Depreciation Report</a></li>
      <li><a href='/reports/funding'><i>ğŸ’µ</i>Funding Report</a></li>
      <li><a href='/reports/lease-asset'><i>ğŸ“</i>Lease Asset Report</a></li>
      <li><a href='/reports/maintenance'><i>ğŸ”§</i>Maintenance Report</a></li>
      <li><a href='/reports/reservation'><i>ğŸ”–</i>Reservation Report</a></li>
      <li><a href='/reports/status'><i>ğŸ“Š</i>Status Report</a></li>
      <li><a href='/reports/transaction'><i>ğŸ’³</i>Transaction Report</a></li>
      <li><a href='/reports/other'><i>ğŸ“‹</i>Other Report</a></li>
    </ul>
  </li>
  
  <!-- Lists -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ“‹</i>Lists <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/lists/assets'><i>ğŸ“¦</i>Lists of Assets</a></li>
      <li><a href='/lists/maintenances'><i>ğŸ”§</i>Lists of Maintenances</a></li>
      <li><a href='/lists/contracts'><i>ğŸ“„</i>Lists of Contracts</a></li>
    </ul>
  </li>
  
  <!-- Advanced Features -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>âš™ï¸</i>Advanced <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/contracts'><i>ğŸ“„</i>Contracts/Licenses</a></li>
      <li><a href='/funding'><i>ğŸ’µ</i>Funding</a></li>
    </ul>
  </li>
  
  <!-- Setup & Configuration -->
  <li class="menu-item-has-children">
    <a href='#' class="submenu-toggle"><i>ğŸ”§</i>Setup/Configuration <span class="arrow">â–¼</span></a>
    <ul class="submenu">
      <li><a href='/users'><i>ï¿½</i>Users</a></li>
      <li><a href='/groups'><i>ğŸ”—</i>Groups</a></li>
      <li><a href='/company-info'><i>ğŸ¢</i>Company Info</a></li>
      <li><a href='/locations'><i>ğŸ“</i>Locations</a></li>
      <li><a href='/departments'><i>ğŸ›ï¸</i>Departments</a></li>
      <li><a href='/categories'><i>ğŸ·ï¸</i>Categories</a></li>
      <li><a href='/subcategories'><i>ğŸ“‘</i>Subcategories</a></li>
      <li><a href='/assign-group'><i>ï¿½</i>Assign Group</a></li>
      <li><a href='/manage-dashboard'><i>ğŸ“Š</i>Manage Dashboard</a></li>
      <li><a href='/database'><i>ï¿½</i>Database</a></li>
      <li class="submenu-item-has-children">
        <a href='#' class="submenu-toggle-nested"><i>ğŸ“</i>Customize Forms <span class="arrow-nested">â–¼</span></a>
        <ul class="nested-submenu">
          <li><a href='/customize-assets-form'><i>ğŸ“¦</i>Assets Form</a></li>
          <li><a href='/customize-customers-form'><i>ğŸ‘¥</i>Customers Form</a></li>
          <li><a href='/customize-maintenance-form'><i>ğŸ”§</i>Maintenance Form</a></li>
          <li><a href='/customize-contracts-form'><i>ğŸ“„</i>Contracts Form</a></li>
        </ul>
      </li>
    </ul>
  </li>
  
  <!-- Help & Support -->
  <li><a href='/help-support'><i>â“</i>Help & Support</a></li>
    </ul>
  </div>
  <div class="main-content">
    <div class="topbar">
      <div class="topbar-actions">
        <a class="btn-link" href="/assets"><i>ğŸ“‹</i> Asset List</a>
        <a class="btn-link" href="/add"><i>â•</i> Add Asset</a>
      </div>
      <div class="search-bar">
        <form method="get" action="/" style="flex:1;display:flex;position:relative;">
          <div class="dropdown" style="position:relative;">
            <button type="button" class="dropdown-toggle" style="padding:10px 15px;background-color:#3498db;color:white;border:none;border-radius:5px 0 0 5px;cursor:pointer;font-size:14px;height:40px;display:flex;align-items:center;gap:5px;">
              <span>ğŸ”</span>
              <span style="font-size:10px;">â–¼</span>
            </button>
            <div class="dropdown-menu" style="display:none;position:absolute;top:100%;left:0;background:white;border:1px solid #ddd;border-radius:5px;box-shadow:0 4px 12px rgba(0,0,0,0.15);min-width:200px;z-index:1000;margin-top:5px;">
              <a href="/assets" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ“‹</i> List of Assets</a>
              <a href="/add" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>â•</i> Add an Asset</a>
              <a href="/update" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ”„</i> Update Quantity</a>
              <a href="/checkout" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ“¤</i> Check Out</a>
              <a href="/checkin" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ“¥</i> Check In</a>
              <a href="/lease" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ“</i> Lease</a>
              <a href="/lease-return" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>â†©ï¸</i> Lease Return</a>
              <a href="/maintenance" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ”§</i> Maintenance</a>
              <a href="/move" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸšš</i> Move</a>
              <a href="/reserve" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;border-bottom:1px solid #ecf0f1;transition:background 0.2s;"><i>ğŸ”–</i> Reserve</a>
              <a href="/dispose" style="display:block;padding:10px 15px;color:#2c3e50;text-decoration:none;transition:background 0.2s;"><i>ğŸ—‘ï¸</i> Dispose</a>
            </div>
          </div>
          <input type="text" placeholder="Search assets, suppliers, or categories..." name="q" value="{{ request.args.get('q','') }}" style="flex:1;padding:10px 15px;border:1px solid #ddd;border-left:none;border-radius:0 5px 5px 0;height:40px;box-sizing:border-box;font-size:14px;">
          <button type="submit" style="position:absolute;right:10px;top:50%;transform:translateY(-50%);background:none;border:none;color:#999;cursor:pointer;font-size:18px;padding:5px;">ğŸ”</button>
        </form>
      </div>
      <div class="theme-switcher">
        <div class="dropdown">
          <button class="dropdown-toggle theme-btn" id="theme-toggle">
            <span class="theme-icon">ğŸŒ™</span>
          </button>
          <div class="dropdown-menu" id="theme-menu">
            <a href="#" class="theme-option" data-theme="light">â˜€ï¸ Light</a>
            <a href="#" class="theme-option" data-theme="dark">ğŸŒ™ Dark</a>
            <a href="#" class="theme-option" data-theme="auto">ğŸ”„ Auto</a>
          </div>
        </div>
      </div>
      <div class="user-menu">
        {% if session.get('username') %}
          <div class="dropdown">
            <button class="dropdown-toggle">{{ session.get('username') }} â–¼</button>
            <div class="dropdown-menu">
              <a href="/profile">ğŸ‘¤ My Profile</a>
              <a href="/change-profile">âœï¸ Change Profile</a>
              <a href="/account-details">â„¹ï¸ Account Details</a>
              <div class="dropdown-divider"></div>
              <a href="#" onclick="showKeyboardShortcuts(event)">âŒ¨ï¸ Keyboard Shortcuts</a>
              <div class="dropdown-divider"></div>
              <a href="/logout">ğŸšª Logout</a>
            </div>
          </div>
        {% else %}
          <a class="btn-link" href="/login">Login</a>
        {% endif %}
      </div>
    </div>
    
    <!-- Keyboard Shortcuts Modal -->
    <div id="shortcutsModal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);z-index:10000;align-items:center;justify-content:center;">
      <div style="background:white;padding:30px;border-radius:12px;max-width:500px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,0.3);">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;">
          <h3 style="margin:0;color:#2c3e50;">âŒ¨ï¸ Keyboard Shortcuts</h3>
          <button onclick="hideKeyboardShortcuts()" style="background:none;border:none;font-size:24px;cursor:pointer;color:#95a5a6;">&times;</button>
        </div>
        <div style="display:grid;gap:12px;">
          <div style="display:flex;justify-content:space-between;padding:10px;background:#f8f9fa;border-radius:6px;">
            <span style="color:#7f8c8d;">Add Asset</span>
            <kbd style="background:#fff;padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-family:monospace;">Alt + A</kbd>
          </div>
          <div style="display:flex;justify-content:space-between;padding:10px;background:#f8f9fa;border-radius:6px;">
            <span style="color:#7f8c8d;">Asset List</span>
            <kbd style="background:#fff;padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-family:monospace;">Alt + L</kbd>
          </div>
          <div style="display:flex;justify-content:space-between;padding:10px;background:#f8f9fa;border-radius:6px;">
            <span style="color:#7f8c8d;">Dashboard</span>
            <kbd style="background:#fff;padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-family:monospace;">Alt + H</kbd>
          </div>
          <div style="display:flex;justify-content:space-between;padding:10px;background:#f8f9fa;border-radius:6px;">
            <span style="color:#7f8c8d;">Focus Search</span>
            <kbd style="background:#fff;padding:4px 8px;border-radius:4px;border:1px solid #ddd;font-family:monospace;">Alt + S</kbd>
          </div>
        </div>
        <div style="margin-top:20px;padding-top:20px;border-top:1px solid #ecf0f1;text-align:center;">
          <button onclick="hideKeyboardShortcuts()" style="background:linear-gradient(135deg, #f9d423 0%, #4ca1af 50%, #2ecc71 100%);color:white;border:none;padding:10px 30px;border-radius:6px;cursor:pointer;font-weight:600;">Got it!</button>
        </div>
      </div>
    </div>
    
    <div class="container">
      {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
          {% for category, msg in messages %}
            <div class="message {{ category }}">{{ msg }}</div>
          {% endfor %}
        {% endif %}
      {% endwith %}
      {% block content %}{% endblock %}
    </div>
  </div>
  
  <!-- Back to Top Button -->
  <button class="back-to-top" id="backToTop" onclick="scrollToTop()" aria-label="Back to top">
    â†‘
  </button>
  
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading...</div>
  </div>
  
  <script>
    // Back to top button
    const backToTopBtn = document.getElementById('backToTop');
    
    window.addEventListener('scroll', function() {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.add('show');
      } else {
        backToTopBtn.classList.remove('show');
      }
    });
    
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Form submission loading state
    document.addEventListener('DOMContentLoaded', function() {
      const forms = document.querySelectorAll('form');
      const loadingOverlay = document.getElementById('loadingOverlay');
      
      forms.forEach(form => {
        form.addEventListener('submit', function(e) {
          // Skip if form has onsubmit that returns false
          if (form.hasAttribute('onsubmit')) {
            const onsubmit = form.getAttribute('onsubmit');
            if (onsubmit.includes('return false') || onsubmit.includes('confirm')) {
              return;
            }
          }
          
          // Show loading overlay
          if (loadingOverlay) {
            loadingOverlay.classList.add('active');
          }
          
          // Disable submit buttons to prevent double submission
          const submitBtns = form.querySelectorAll('[type="submit"]');
          submitBtns.forEach(btn => {
            btn.disabled = true;
            btn.style.opacity = '0.6';
            btn.style.cursor = 'not-allowed';
          });
        });
      });
    });
  </script>
  
  <script>
    // Mobile menu toggle
    document.addEventListener('DOMContentLoaded', function() {
      const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      const mainContent = document.querySelector('.main-content');
      
      if (mobileMenuToggle && sidebar) {
        mobileMenuToggle.addEventListener('click', function() {
          sidebar.classList.toggle('mobile-open');
          this.textContent = sidebar.classList.contains('mobile-open') ? 'âœ•' : 'â˜°';
        });
        
        // Close sidebar when clicking outside on mobile
        mainContent.addEventListener('click', function(e) {
          if (window.innerWidth <= 768 && sidebar.classList.contains('mobile-open')) {
            sidebar.classList.remove('mobile-open');
            mobileMenuToggle.textContent = 'â˜°';
          }
        });
        
        // Close sidebar when clicking a menu item on mobile
        const menuLinks = sidebar.querySelectorAll('a');
        menuLinks.forEach(link => {
          link.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
              sidebar.classList.remove('mobile-open');
              mobileMenuToggle.textContent = 'â˜°';
            }
          });
        });
      }
      
      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
        // Alt + A = Add Asset
        if (e.altKey && e.key === 'a') {
          e.preventDefault();
          window.location.href = '/add';
        }
        // Alt + L = Asset List
        if (e.altKey && e.key === 'l') {
          e.preventDefault();
          window.location.href = '/assets';
        }
        // Alt + H = Home/Dashboard
        if (e.altKey && e.key === 'h') {
          e.preventDefault();
          window.location.href = '/';
        }
        // Alt + S = Focus Search
        if (e.altKey && e.key === 's') {
          e.preventDefault();
          const searchInput = document.querySelector('.search-bar input[type="text"]');
          if (searchInput) searchInput.focus();
        }
      });
      
      // Add smooth scroll behavior
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          if (href !== '#') {
            e.preventDefault();
            const target = document.querySelector(href);
            if (target) {
              target.scrollIntoView({ behavior: 'smooth' });
            }
          }
        });
      });
      
      // Auto-hide flash messages after 5 seconds
      const messages = document.querySelectorAll('.message');
      messages.forEach(message => {
        setTimeout(() => {
          message.style.transition = 'opacity 0.5s, transform 0.5s';
          message.style.opacity = '0';
          message.style.transform = 'translateY(-20px)';
          setTimeout(() => message.remove(), 500);
        }, 5000);
      });
    });
  </script>
  
  <script>
    // Keyboard shortcuts modal
    function showKeyboardShortcuts(e) {
      e.preventDefault();
      const modal = document.getElementById('shortcutsModal');
      modal.style.display = 'flex';
    }
    
    function hideKeyboardShortcuts() {
      const modal = document.getElementById('shortcutsModal');
      modal.style.display = 'none';
    }
    
    // Close modal on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hideKeyboardShortcuts();
      }
    });
    
    // Close modal when clicking outside
    document.getElementById('shortcutsModal')?.addEventListener('click', function(e) {
      if (e.target === this) {
        hideKeyboardShortcuts();
      }
    });
  </script>
  
  <script>
    // Theme switcher functionality
    const themeToggle = document.getElementById('theme-toggle');
    const themeMenu = document.getElementById('theme-menu');
    const themeOptions = document.querySelectorAll('.theme-option');
    const themeIcon = document.querySelector('.theme-icon');
    
    // Load saved theme or default to auto
    let currentTheme = localStorage.getItem('theme') || 'auto';
    applyTheme(currentTheme);
    
    // Theme option selection
    themeOptions.forEach(option => {
      option.addEventListener('click', (e) => {
        e.preventDefault();
        const theme = option.dataset.theme;
        currentTheme = theme;
        localStorage.setItem('theme', theme);
        applyTheme(theme);
      });
    });
    
    function applyTheme(theme) {
      const root = document.documentElement;
      
      if (theme === 'auto') {
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        root.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        themeIcon.textContent = 'ğŸ”„';
      } else {
        root.setAttribute('data-theme', theme);
        themeIcon.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
      }
      
      // Highlight active option
      themeOptions.forEach(opt => {
        opt.classList.toggle('active', opt.dataset.theme === theme);
      });
    }
    
    // Listen for system theme changes in auto mode
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
      if (currentTheme === 'auto') {
        applyTheme('auto');
      }
    });
  </script>
  <script>
    // Sidebar submenu toggle
    document.querySelectorAll('.submenu-toggle').forEach(toggle => {
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        const parent = this.parentElement;
        parent.classList.toggle('active');
      });
    });
    
    // Nested submenu toggle
    document.querySelectorAll('.submenu-toggle-nested').forEach(toggle => {
      toggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        const parent = this.parentElement;
        parent.classList.toggle('active');
      });
    });
    
    // Search dropdown toggle
    document.addEventListener('DOMContentLoaded', function() {
      const searchDropdownToggle = document.querySelector('.search-bar .dropdown-toggle');
      const searchDropdownMenu = document.querySelector('.search-bar .dropdown-menu');
      
      if (searchDropdownToggle && searchDropdownMenu) {
        searchDropdownToggle.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          searchDropdownMenu.style.display = searchDropdownMenu.style.display === 'block' ? 'none' : 'block';
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
          if (!e.target.closest('.search-bar .dropdown')) {
            searchDropdownMenu.style.display = 'none';
          }
        });
        
        // Add hover effects to menu items
        const menuItems = searchDropdownMenu.querySelectorAll('a');
        menuItems.forEach(item => {
          item.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#ecf0f1';
          });
          item.addEventListener('mouseleave', function() {
            this.style.backgroundColor = 'white';
          });
        });
      }
    });
  </script>
</body>
</html>
